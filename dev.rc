#!/bin/bash

echo "Loading dev.rc file for the api repository..."

# Function to commit and push changes to Git
commit_and_push() {
  if [ -z "$1" ]; then
    echo "No commit message provided. Please enter a commit message:"
    read commit_message
  else
    commit_message="$1"
  fi

  if [ -z "$commit_message" ]; then
    echo "Commit message is required. Exiting."
    return 1
  fi

  echo "Enter the subject of the commit message (feat|bug|fix|setup|chore). Default is 'feat':"
  read commit_subject

  if [ -z "$commit_subject" ]; then
    commit_subject="feat"
  fi

  case $commit_subject in
    feat|bug|fix|setup|chore)
      ;;
    *)
      echo "Invalid subject. Defaulting to 'feat'."
      commit_subject="feat"
      ;;
  esac

  final_commit_message="[$commit_subject]: $commit_message"

  # Commit changes in the api directory
  git add . && git commit -m "$final_commit_message" && git push

  # Commit changes in the root directory
  cd .. && git add . && git commit -m "$final_commit_message" && git push && cd api

  # Check if commit was successful
  if [ $? -ne 0 ]; then
    echo "Commit failed. Please check for errors."
    return 1
  fi

  # Push to the current branch
  git push

  # Check if push was successful
  if [ $? -ne 0 ]; then
    echo "Push failed. Please check for errors."
    return 1
  fi

  echo "Changes committed and pushed successfully."
}

alias cap=commit_and_push
